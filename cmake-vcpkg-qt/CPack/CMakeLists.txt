set(CPACK_PACKAGE_NAME MyApp)
set(CPACK_PACKAGE_NAME_CAPITALISED MyApp)

set(CPACK_PACKAGE_VERSION "${PROJECT_VERSION}")
set(CPACK_PACKAGE_VERSION_MAJOR "${PROJECT_VERSION_MAJOR}")
set(CPACK_PACKAGE_VERSION_MINOR "${PROJECT_VERSION_MINOR}")
set(CPACK_PACKAGE_VERSION_PATCH "${PROJECT_VERSION_PATCH}")
set(CPACK_PACKAGE_VERSION_TWEAK "${PROJECT_VERSION_TWEAK}")
set(CPACK_PACKAGE_FULL_VERSION "${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH}.${PROJECT_VERSION_TWEAK}")

set(CPACK_PACKAGE_VENDOR "Dmitry Ivanov")
set(CPACK_PACKAGE_HOMEPAGE_URL "https://d-k-ivanov.github.io/")
set(CPACK_PACKAGE_COPYRIGHT "(c) 2023-${CMAKE_DATE_YEAR} ${CPACK_PACKAGE_VENDOR}")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${CPACK_PACKAGE_NAME_CAPITALISED}-${CPACK_PACKAGE_FULL_VERSION}")
set(CPACK_PACKAGE_DESCRIPTION_FILE "${CMAKE_CURRENT_LIST_DIR}/Description.txt")
set(CPACK_PACKAGE_INSTALL_DIRECTORY "${CPACK_PACKAGE_NAME}-${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}")
set(CPACK_PACKAGE_EXECUTABLES "${CPACK_PACKAGE_NAME};${CPACK_PACKAGE_NAME_CAPITALISED}-${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}")
set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}")
set(CPACK_PACKAGE_ICON "${CMAKE_CURRENT_LIST_DIR}\\Header.bmp")

set(CPACK_VERBATIM_VARIABLES YES)
set(CPACK_THREADS 0)

set(CPACK_RESOURCE_FILE_WELCOME "${CMAKE_CURRENT_LIST_DIR}/Welcome.txt")
set(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_LIST_DIR}/License.txt")
set(CPACK_RESOURCE_FILE_README "${CMAKE_CURRENT_LIST_DIR}/Readme.txt")

set(CPACK_OUTPUT_CONFIG_FILE "${CMAKE_BINARY_DIR}/CPackConfig_${CPACK_PACKAGE_NAME}.cmake")
set(CPACK_SOURCE_OUTPUT_CONFIG_FILE "${CMAKE_BINARY_DIR}/CPackSourceConfig_${CPACK_PACKAGE_NAME}.cmake")

set(CPACK_INSTALL_CMAKE_PROJECTS "${CMAKE_BINARY_DIR};${PROJECT_NAME};${CPACK_PACKAGE_NAME};/")
set(CPACK_NSIS_MUI_ICON "${CMAKE_CURRENT_LIST_DIR}\\${CPACK_PACKAGE_NAME_CAPITALISED}.ico")
set(CPACK_NSIS_MUI_UNIICON "${CPACK_NSIS_MUI_ICON}")
set(CPACK_NSIS_INSTALLER_MUI_ICON_CODE "!define MUI_WELCOMEFINISHPAGE_BITMAP ${CMAKE_CURRENT_LIST_DIR}\\Wizard.bmp")
set(CPACK_NSIS_INSTALLED_ICON_NAME "${CPACK_PACKAGE_NAME}.exe")
set(CPACK_NSIS_ENABLE_UNINSTALL_BEFORE_INSTALL ON)
set(CPACK_NSIS_DISPLAY_NAME "${CPACK_PACKAGE_NAME_CAPITALISED} ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}")
set(CPACK_NSIS_PACKAGE_NAME "${CPACK_NSIS_DISPLAY_NAME}")
set(CPACK_NSIS_URL_INFO_ABOUT "${CPACK_PACKAGE_HOMEPAGE_URL}")

set(CPACK_NSIS_DEFINES "${CPACK_NSIS_DEFINES}
    VIProductVersion ${CPACK_PACKAGE_FULL_VERSION}
    VIFileVersion ${CPACK_PACKAGE_FULL_VERSION}
    VIAddVersionKey /LANG=0 \"ProductName\"     \"${CPACK_NSIS_PACKAGE_NAME}\"
    VIAddVersionKey /LANG=0 \"ProductVersion\"  \"${CPACK_PACKAGE_FULL_VERSION}\"
    VIAddVersionKey /LANG=0 \"Comments\"        \"${CPACK_NSIS_DISPLAY_NAME}\"
    VIAddVersionKey /LANG=0 \"CompanyName\"     \"${CPACK_PACKAGE_VENDOR}\"
    VIAddVersionKey /LANG=0 \"LegalCopyright\"  \"${CPACK_PACKAGE_COPYRIGHT}\"
    VIAddVersionKey /LANG=0 \"FileDescription\" \"${CPACK_NSIS_PACKAGE_NAME} Installer\"
    VIAddVersionKey /LANG=0 \"FileVersion\"     \"${CPACK_PACKAGE_FULL_VERSION}\"
")

# Folders and registry settings for NSIS
# set(CPACK_NSIS_EXTRA_INSTALL_COMMANDS "
#     CreateDirectory \"$LOCALAPPDATA\\MyApp\\DirOne\"
#     CreateDirectory \"$LOCALAPPDATA\\MyApp\\DirTwo\"
#
#     ClearErrors
#     ReadRegStr \$0 HKCU \"SOFTWARE\\MyApp\" \"working_dir_one\"
#     \${If} \${Errors}
#         WriteRegStr HKCU \"SOFTWARE\\MyApp\" \"working_dir_one\" \"$LOCALAPPDATA\\MyApp\\DirOne\"
#     \${EndIf}
#
#     ClearErrors
#     ReadRegStr \$0 HKCU \"SOFTWARE\\MyApp\" \"working_dir_two\"
#     \${If} \${Errors}
#         WriteRegStr HKCU \"SOFTWARE\\MyApp\" \"working_dir_two\" \"$LOCALAPPDATA\\MyApp\\DirTwo\"
#     \${EndIf}
# ")

include(CPack)
